# 무한 스크롤 테스트 가이드 📋

**작성일**: 2026-01-29  
**목적**: 상단 스크롤 버벅임 해결 검증

---

## 🎯 테스트 목표

`maintainVisibleContentPosition` 적용으로 상단 스크롤 시 버벅임이 해결되었는지 확인

---

## 📝 테스트 절차

### 1. 앱 실행 및 UltimateCalendar 진입
```
1. 앱 실행
2. TodoScreen 진입
3. 콘솔 확인
```

**예상 로그:**
```
📅 [UltimateCalendar] 초기 데이터 생성 시작...
🔍 [디버그] 초기 데이터:
  - 첫 주: 2025-07-27 ~ 2025-08-02
  - 마지막 주: 2027-01-24 ~ 2027-01-30
✅ [UltimateCalendar] 초기 생성 완료: 83주 (X.XXms)
📅 [UltimateCalendar] 범위: 2025-07 ~ 2027-01
📍 [UltimateCalendar] 오늘 인덱스: XX
```

---

### 2. 하단 스크롤 테스트 (기준선)

**동작:**
1. 주간 뷰에서 아래로 계속 스크롤
2. 끝에 가까워지면 자동으로 12개월 추가됨

**예상 로그:**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔽 [하단 스크롤] 트리거됨
1️⃣ [현재 상태]
   - 현재 총 주 수: 83주
2️⃣ [데이터 생성]
   - 기존 마지막 주: 2027-01-24 ~ 2027-01-30
   - 생성 범위: 2027-01-31 ~ 2028-01-31
3️⃣ [중복 체크] 중복 없음 ✓
   - 추가될 주 수: 52주
   - 추가 첫 주: 2027-01-31 ~ 2027-02-06
   - 추가 마지막 주: 2028-01-23 ~ 2028-01-29
4️⃣ [상태 업데이트] 배열 뒤에 추가 (인덱스 불변)
✅ [완료] 52주 추가 완료 (X.XXms)
   - 새 총 주 수: 135주
   - 버벅임: 없음 (하단 추가는 원래 부드러움)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**체크포인트:**
- ✅ 스크롤이 부드러움
- ✅ 데이터가 자동으로 추가됨
- ✅ 화면이 끊기지 않음

---

### 3. 상단 스크롤 테스트 (핵심!)

**동작:**
1. 주간 뷰에서 위로 계속 스크롤
2. 시작 부분에 가까워지면 자동으로 12개월 추가됨
3. **버벅임 없이 부드럽게 스크롤되어야 함!**

**예상 로그 (성공 케이스):**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔼 [상단 스크롤] 트리거됨
1️⃣ [현재 상태]
   - 현재 보는 인덱스: 16
   - 현재 총 주 수: 83주
2️⃣ [데이터 생성]
   - 기존 첫 주: 2025-07-27 ~ 2025-08-02
   - 생성 범위: 2024-07-01 ~ 2025-07-26
3️⃣ [중복 체크] 중복 없음 ✓
   - 추가될 주 수: 56주
   - 추가 첫 주: 2024-06-30 ~ 2024-07-06
   - 추가 마지막 주: 2025-07-20 ~ 2025-07-26
4️⃣ [ref 업데이트]
   - 새 인덱스: 72 (16 + 56)
5️⃣ [상태 업데이트] maintainVisibleContentPosition이 위치 자동 유지...
✅ [완료] 56주 추가 완료 (X.XXms)
   - 새 총 주 수: 139주
   - 버벅임: maintainVisibleContentPosition이 방지함
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**체크포인트:**
- ✅ 스크롤이 부드러움 (버벅임 없음!)
- ✅ 데이터가 자동으로 추가됨
- ✅ 화면이 끊기지 않음
- ✅ 내가 보던 주가 그대로 유지됨

---

### 4. 월간 뷰 테스트

**동작:**
1. 핸들 바를 아래로 드래그 → 월간 뷰 전환
2. 위로 스크롤 → 상단 데이터 추가
3. 아래로 스크롤 → 하단 데이터 추가

**예상 로그:**
```
📍 [월간뷰] 인덱스 변경: 16 → 20
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔼 [상단 스크롤] 트리거됨
...
✅ [완료] 56주 추가 완료
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**체크포인트:**
- ✅ 주간 뷰와 동일하게 부드러움
- ✅ 모드 전환 시에도 정상 작동

---

## 🚨 문제 발생 시 로그 패턴

### 패턴 1: 버벅임 발생
```
🔼 [상단 스크롤] 트리거됨
...
✅ [완료] 56주 추가 완료
📍 [주간뷰] 스크롤 이동: 72  ← 이게 보이면 문제!
```
**의미**: `maintainVisibleContentPosition`이 작동하지 않아서 수동 스크롤 발생

**해결**: FlashList 버전 확인 필요

---

### 패턴 2: 중복 데이터
```
3️⃣ [중복 제거] 마지막 주 제거됨  ← 자주 보이면 문제
```
**의미**: 날짜 계산 로직에 문제

**해결**: generateCalendarData 범위 확인

---

### 패턴 3: 인덱스 불일치
```
1️⃣ [현재 상태]
   - 현재 보는 인덱스: 16
...
📍 [주간뷰] 인덱스 변경: 16 → 16  ← 변경 안 됨!
```
**의미**: ref 업데이트가 안 됨

**해결**: handleWeekChange 호출 확인

---

## ✅ 성공 기준

### 필수 (MUST)
- [ ] 상단 스크롤 시 버벅임 없음
- [ ] 하단 스크롤 시 버벅임 없음
- [ ] 데이터 중복 없음
- [ ] 인덱스 정상 업데이트

### 권장 (SHOULD)
- [ ] 로딩 시간 100ms 이하
- [ ] 메모리 사용량 안정적
- [ ] 10회 이상 연속 스크롤 가능

---

## 📊 성능 측정

### 측정 항목
1. **로딩 시간**: `✅ [완료] XXms` 확인
2. **버벅임**: 육안으로 확인
3. **메모리**: 개발자 도구에서 확인

### 예상 성능
- 초기 로딩: 0.3ms
- 12개월 추가: 0.5ms
- 버벅임: 없음

---

## 🐛 디버깅 팁

### 로그가 안 보이면?
```javascript
// 콘솔 필터 설정
console.log 필터: "스크롤" 또는 "UltimateCalendar"
```

### 버벅임이 여전히 있으면?
1. `maintainVisibleContentPosition` 적용 확인
2. FlashList 버전 확인 (최신 버전 권장)
3. `estimatedItemSize` 정확한지 확인

### 데이터가 추가 안 되면?
1. `onEndReached` / `onStartReached` 호출 확인
2. `isLoadingMore` / `isLoadingPast` 플래그 확인
3. 임계값 조정 (15주 → 20주)

---

## 📝 테스트 결과 보고 양식

테스트 후 아래 형식으로 로그를 보내주세요:

```
## 테스트 환경
- 기기: iOS / Android / Web
- 모드: 주간 / 월간

## 하단 스크롤
[로그 복사]

## 상단 스크롤
[로그 복사]

## 버벅임 여부
- 하단: 있음 / 없음
- 상단: 있음 / 없음

## 기타 이슈
[문제 설명]
```

---

## 🎉 완료!

모든 테스트가 통과하면 무한 스크롤 구현 완료입니다!
